<!DOCTYPE html>
<html>
<title>Talking Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
<script type="text/javascript" src="http://maps.stamen.com/js/tile.stamen.js?v1.3.0"></script>
<script type="text/javascript">(function(e){e.fn.extend({slimScroll:function(f){var a=e.extend({width:"auto",height:"250px",size:"7px",color:"#000",position:"right",distance:"1px",start:"top",opacity:.4,alwaysVisible:!1,disableFadeOut:!1,railVisible:!1,railColor:"#333",railOpacity:.2,railDraggable:!0,railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:!1,wheelStep:20,touchScrollStep:200,borderRadius:"7px",railBorderRadius:"7px"},f);this.each(function(){function v(d){if(r){d=d||window.event;
var c=0;d.wheelDelta&&(c=-d.wheelDelta/120);d.detail&&(c=d.detail/3);e(d.target||d.srcTarget||d.srcElement).closest("."+a.wrapperClass).is(b.parent())&&n(c,!0);d.preventDefault&&!k&&d.preventDefault();k||(d.returnValue=!1)}}function n(d,g,e){k=!1;var f=b.outerHeight()-c.outerHeight();g&&(g=parseInt(c.css("top"))+d*parseInt(a.wheelStep)/100*c.outerHeight(),g=Math.min(Math.max(g,0),f),g=0<d?Math.ceil(g):Math.floor(g),c.css({top:g+"px"}));l=parseInt(c.css("top"))/(b.outerHeight()-c.outerHeight());g=
l*(b[0].scrollHeight-b.outerHeight());e&&(g=d,d=g/b[0].scrollHeight*b.outerHeight(),d=Math.min(Math.max(d,0),f),c.css({top:d+"px"}));b.scrollTop(g);b.trigger("slimscrolling",~~g);w();p()}function x(){u=Math.max(b.outerHeight()/b[0].scrollHeight*b.outerHeight(),30);c.css({height:u+"px"});var a=u==b.outerHeight()?"none":"block";c.css({display:a})}function w(){x();clearTimeout(B);l==~~l?(k=a.allowPageScroll,C!=l&&b.trigger("slimscroll",0==~~l?"top":"bottom")):k=!1;C=l;u>=b.outerHeight()?k=!0:(c.stop(!0,
!0).fadeIn("fast"),a.railVisible&&m.stop(!0,!0).fadeIn("fast"))}function p(){a.alwaysVisible||(B=setTimeout(function(){a.disableFadeOut&&r||y||z||(c.fadeOut("slow"),m.fadeOut("slow"))},1E3))}var r,y,z,B,A,u,l,C,k=!1,b=e(this);if(b.parent().hasClass(a.wrapperClass)){var q=b.scrollTop(),c=b.siblings("."+a.barClass),m=b.siblings("."+a.railClass);x();if(e.isPlainObject(f)){if("height"in f&&"auto"==f.height){b.parent().css("height","auto");b.css("height","auto");var h=b.parent().parent().height();b.parent().css("height",
h);b.css("height",h)}else"height"in f&&(h=f.height,b.parent().css("height",h),b.css("height",h));if("scrollTo"in f)q=parseInt(a.scrollTo);else if("scrollBy"in f)q+=parseInt(a.scrollBy);else if("destroy"in f){c.remove();m.remove();b.unwrap();return}n(q,!1,!0)}}else if(!(e.isPlainObject(f)&&"destroy"in f)){a.height="auto"==a.height?b.parent().height():a.height;q=e("<div></div>").addClass(a.wrapperClass).css({position:"relative",overflow:"hidden",width:a.width,height:a.height});b.css({overflow:"hidden",
width:a.width,height:a.height});var m=e("<div></div>").addClass(a.railClass).css({width:a.size,height:"100%",position:"absolute",top:0,display:a.alwaysVisible&&a.railVisible?"block":"none","border-radius":a.railBorderRadius,background:a.railColor,opacity:a.railOpacity,zIndex:90}),c=e("<div></div>").addClass(a.barClass).css({background:a.color,width:a.size,position:"absolute",top:0,opacity:a.opacity,display:a.alwaysVisible?"block":"none","border-radius":a.borderRadius,BorderRadius:a.borderRadius,MozBorderRadius:a.borderRadius,
WebkitBorderRadius:a.borderRadius,zIndex:99}),h="right"==a.position?{right:a.distance}:{left:a.distance};m.css(h);c.css(h);b.wrap(q);b.parent().append(c);b.parent().append(m);a.railDraggable&&c.bind("mousedown",function(a){var b=e(document);z=!0;t=parseFloat(c.css("top"));pageY=a.pageY;b.bind("mousemove.slimscroll",function(a){currTop=t+a.pageY-pageY;c.css("top",currTop);n(0,c.position().top,!1)});b.bind("mouseup.slimscroll",function(a){z=!1;p();b.unbind(".slimscroll")});return!1}).bind("selectstart.slimscroll",
function(a){a.stopPropagation();a.preventDefault();return!1});m.hover(function(){w()},function(){p()});c.hover(function(){y=!0},function(){y=!1});b.hover(function(){r=!0;w();p()},function(){r=!1;p()});b.bind("touchstart",function(a,b){a.originalEvent.touches.length&&(A=a.originalEvent.touches[0].pageY)});b.bind("touchmove",function(b){k||b.originalEvent.preventDefault();b.originalEvent.touches.length&&(n((A-b.originalEvent.touches[0].pageY)/a.touchScrollStep,!0),A=b.originalEvent.touches[0].pageY)});
x();"bottom"===a.start?(c.css({top:b.outerHeight()-c.outerHeight()}),n(0,!0)):"top"!==a.start&&(n(e(a.start).position().top,null,!0),a.alwaysVisible||c.hide());window.addEventListener?(this.addEventListener("DOMMouseScroll",v,!1),this.addEventListener("mousewheel",v,!1)):document.attachEvent("onmousewheel",v)}});return this}});e.fn.extend({slimscroll:e.fn.slimScroll})})(jQuery);</script>

<style>
    
html,body,h1,h2,h3,h4,h5 {font-family: "Raleway", sans-serif}

.footer{position:absolute;bottom:0px;width:100%;}

.header{
    -webkit-box-shadow: 0px 0px 6px 2px rgba(184,184,184,1);
    -moz-box-shadow: 0px 0px 6px 2px rgba(184,184,184,1);
    box-shadow: 0px 0px 6px 2px rgba(184,184,184,1);    
}

.navigation{ float:right;}

.nav-button{width:150px;}

.border-top{border-top: 1px solid #ccc;}

</style>

<!-- This is your storymap-data -->
<script type="text/javascript" src="data/dummy.json"></script>

<!-- This is the styling-theme -->
<link rel="stylesheet" href="themes/emerald.css">

<body>

<header class="w3-container w3-theme header">
  <div class="w3-quarter"><h3 id="story-title"></h3></div>
  <div class="w3-rest navigation w3-padding">
    <div id="pages" class="w3-bar">
    </div>  
  </div>
</header>


<div>
<div class="w3-third story-wrapper">
    <div id="story" class="story w3-margin-small">
        <div class="w3-padding titlebox"><h4 class="title w3-text-theme"></h4></div>
        <div class="content w3-padding"></div>
    
    </div>
</div>
<div class="w3-twothird map-wrapper"></div>
</div>

<footer class="footer w3-padding w3-theme w3-margin-top">
  2017 | Martin Sudmanns
</footer>

</body>

<script>
/*
 * Defining global variable,s including storage
 */
var current_page = -1;
var current_map = null;
var storage = {};    
</script>

<script>
$(function(){

   /*
    * Setting height and width
    */
    var height = $(document).height();
    var margins = 56;
    var story_height = height - $("header").height() - $("footer").height() - margins;
    var map_height = height - $(".header").height() - $(".footer").height() - margins;

    $(".story-wrapper").height(story_height);
    $(".map-wrapper").height(map_height);
    $(".map-wrapper").append('<div id="map"></div>');
    $("#map").height(map_height);          

    /*
     * Set pages
     */
     
    function setPage(page){
        
        // cleanup storage
        if (current_page != -1){
            if (storymap.pages[current_page].cleanupHook != null){
                storymap.pages[current_page].cleanupHook();
            }
        }
        storage = {};
        
        current_page = page;
                
        $("#story").find(".title").text(storymap.pages[page].title);
        $("#story").find(".content")
            .html(storymap.pages[page].content)
            .append('<div class="w3-margin w3-center border-top"><div id="nav-button-back" class="w3-btn w3-theme w3-margin nav-button">Back</div><div id="nav-button-cont" class="w3-btn w3-theme nav-button w3-margin ">Continue</div></div>')
            .slimScroll({
                height:  (story_height - 38 - $("#story").find(".title").height()) + 'px'
            });
        

        storymap.pages[page].map();

        $("button").addClass("w3-button w3-block w3-round w3-margin-top w3-border-theme");
        
        
        
        if(page==0){
            $("#page-back").addClass("w3-disabled");
            $("#nav-button-back").addClass("w3-disabled");
        }else{
            $("#page-back").removeClass("w3-disabled");
            $("#nav-button-back")
                .removeClass("w3-disabled")
                .click(function(){
                    setPage(current_page-1);
                }); 
        }
        
        if(page==(storymap.pages.length-1)){
            $("#page-forward").addClass("w3-disabled");
            $("#nav-button-cont").addClass("w3-disabled");
        }else{
            $("#page-forward").removeClass("w3-disabled");
            $("#nav-button-cont")
                .removeClass("w3-disabled")
                .click(function(){
                    setPage(current_page+1);
                });                
        }
        
        /*
         * Apply Styling
         */
        $(".content").find("h4").addClass("w3-text-theme");
        $(".content").find("h4").addClass("w3-text-theme");
        $(".content").find("h5").addClass("w3-text-theme");
        $(".content").find("h6").addClass("w3-text-theme");
        $(".content").find("h7").addClass("w3-text-theme");
        
    }
        
     $("#pages").append('<a href="#" id="page-back" class="w3-button w3-disabled page">&laquo;</a>');
      for (var i=0;i<storymap.pages.length;i++){
          $("#pages").append('<a href="#" class="w3-button page">'+(i+1)+'</a>');
      }
      $("#pages").append(' <a href="#" id="page-forward" class="w3-button page">&raquo;</a>');
     
     $(".page").click(function(){
         if ($(this).attr("id") == "page-back"){
             var page = current_page -1;
             setPage(page);
         }else if($(this).attr("id") == "page-forward"){
             var page = current_page + 1;
             setPage(page);
         }else{
           var page = parseInt($(this).text()) - 1;
           setPage(page);
        }
     });
      
    /*
     * Set storymap
     */
    $("#story-title").text(storymap.title);
    setPage(0);

});
</script>
</html>
